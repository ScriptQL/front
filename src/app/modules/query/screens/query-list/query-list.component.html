<div class="section">
  <div class="header">
    <div class="title">
      Recentes
    </div>
    <div class="extra">
      <button mat-raised-button (click)="onNew()">
        <mat-icon fontIcon="add_task"></mat-icon>
        <span>&nbsp;&nbsp;Nova Query</span>
      </button>
    </div>
  </div>
  <div class="content">
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="data.items">
        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon aria-hidden="false" aria-label="Status" fontIcon="more_horiz"></mat-icon>
          </th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.status === 'WAITING_REVIEW'">
              <mat-icon aria-hidden="false" fontIcon="how_to_reg"
                        matTooltip="Awaiting approval"
                        aria-label="Awaiting approval"
              ></mat-icon>
            </span>
            <span *ngIf="element.status === 'APPROVED'">
              <mat-icon aria-hidden="false" fontIcon="hourglass_empty"
                        matTooltip="Awaiting execution"
                        aria-label="Awaiting execution"
              ></mat-icon>
            </span>
            <span *ngIf="element.status === 'REJECTED'">
              <mat-icon aria-hidden="false" fontIcon="close"
                        matTooltip="Rejected"
                        aria-label="Rejected"
              ></mat-icon>
            </span>
            <span *ngIf="element.status === 'EXECUTING'">
              <mat-icon aria-hidden="false" fontIcon="cycle"
                        matTooltip="Executing"
                        aria-label="Executing"
              ></mat-icon>
            </span>
            <span *ngIf="element.status === 'DONE'">
              <mat-icon aria-hidden="false" fontIcon="check"
                        matTooltip="Executed successfully"
                        aria-label="Executed successfully"
              ></mat-icon>
            </span>
          </td>
        </ng-container>

        <!-- Requester Column -->
        <ng-container matColumnDef="requester">
          <th mat-header-cell *matHeaderCellDef>Solicitante</th>
          <td mat-cell *matCellDef="let element">
            <shared-user-details [user]="element.requester"></shared-user-details>
          </td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Descrição</th>
          <td mat-cell *matCellDef="let element">{{element.description | truncate:[65]}}</td>
        </ng-container>

        <!-- Connection Column -->
        <ng-container matColumnDef="connection">
          <th mat-header-cell *matHeaderCellDef>DataSource</th>
          <td mat-cell *matCellDef="let element">
            <a href="/connections/{{ element.connection?.id }}">{{ element.connection?.name }}</a>
          </td>
        </ng-container>

        <!-- Edit Column -->
        <ng-container matColumnDef="more">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon aria-hidden="false" aria-label="More" fontIcon="more_horiz"></mat-icon>
          </th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button routerLink="/queries/{{ element.id }}">
              <mat-icon>open_in_new</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columns"></tr>
        <tr mat-row *matRowDef="let row; columns: columns;"></tr>
      </table>
      <mat-paginator [pageSize]="data.limit"
                     [pageIndex]="data.page - 1"
                     (page)="onPage($event)"
                     [length]="data.total"
                     showFirstLastButtons
                     aria-label="Update list page">
      </mat-paginator>
    </div>
  </div>
</div>
